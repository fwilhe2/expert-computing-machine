package:
  name: finit
  version: 4.7
  epoch: 1
  description: "Fast init for Linux. Cookies included"
  copyright:
    - license: MIT

environment:
  contents:
    packages:
      - bash
      - build-base
      - busybox
      - ca-certificates-bundle

pipeline:
  - uses: fetch
    with:
      uri: https://github.com/troglobit/libite/releases/download/v2.6.1/libite-2.6.1.tar.gz
      expected-sha256: d0a73fa4c91c2fdae4afaa490167359ffc60beeeed47de9cbb67566f3f3f09e5

  - runs: |
      ./configure
      make -j5
      make install-strip
      ldconfig

  - uses: fetch
    with:
      uri: https://github.com/troglobit/libuev/releases/download/v2.4.1/libuev-2.4.1.tar.gz
      expected-sha256: 7a6a31cf5c5df0eb424230588d2c5fa33253fc22a7a5b766d905d1c7ffa979d5

  - runs: |
      ./configure
      make -j5
      make install-strip
      ldconfig

  - uses: fetch
    with:
      uri: https://github.com/troglobit/finit/releases/download/${{package.version}}/finit-${{package.version}}.tar.gz
      expected-sha256: 139adcb81ec8a5bb628249f92e2144b20f7e14c53aa56bb86a2fd42c5e7dca11

  - runs: |
      ./configure \
         --prefix=/usr \
         --libdir=/lib \
         --libexecdir=/usr/libexec

  - uses: autoconf/make

  - name: Make Install
    runs: |
      DESTDIR="${{targets.destdir}}" make install
      mkdir -p "${{targets.destdir}}"/etc
      cp finit/vendor/etc/finit.conf "${{targets.destdir}}"/etc

  - uses: strip
